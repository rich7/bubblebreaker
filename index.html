<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BubbleBreaker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .bubble {
            box-shadow: inset -3px -3px 8px rgba(0,0,0,0.3),
                        inset 3px 3px 8px rgba(255,255,255,0.5);
            transition: transform 0.2s;
        }
        .bubble:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body style="margin:0; min-height:100vh; background:#f3f4f6; display:flex; justify-content:center; align-items:center;">
    <div id="root"></div>

    <script type="text/babel">
        const COLORS = ['bg-red-500', 'bg-blue-500', 'bg-green-500', 'bg-yellow-500', 'bg-purple-500'];
        const GRID_SIZE = 8;

        const BubbleBreaker = () => {
            const [grid, setGrid] = React.useState([]);
            const [score, setScore] = React.useState(0);
            const [highScore, setHighScore] = React.useState(0);

            React.useEffect(() => {
                initializeGrid();
                const saved = localStorage.getItem('bubblebreaker-highscore');
                if (saved) setHighScore(parseInt(saved));
            }, []);

            const initializeGrid = () => {
                const newGrid = Array(GRID_SIZE).fill().map(() =>
                    Array(GRID_SIZE).fill().map(() => ({
                        color: COLORS[Math.floor(Math.random() * COLORS.length)],
                        id: Math.random()
                    }))
                );
                setGrid(newGrid);
                setScore(0);
            };

            const handleBubbleClick = (row, col) => {
                const newGrid = [...grid];
                const color = grid[row][col].color;
                const connected = findConnected(row, col, color, newGrid);
                
                if (connected.length >= 2) {
                    connected.forEach(([r, c]) => {
                        newGrid[r][c] = null;
                    });
                    
                    // Drop bubbles
                    for (let c = 0; c < GRID_SIZE; c++) {
                        const col = newGrid.map(row => row[c]).filter(cell => cell);
                        const newCol = Array(GRID_SIZE - col.length).fill(null).concat(col);
                        for (let r = 0; r < GRID_SIZE; r++) {
                            newGrid[r][c] = newCol[r];
                        }
                    }
                    
                    const newScore = score + connected.length * (connected.length - 1);
                    setScore(newScore);
                    if (newScore > highScore) {
                        setHighScore(newScore);
                        localStorage.setItem('bubblebreaker-highscore', newScore);
                    }
                    setGrid(newGrid);
                }
            };

            const findConnected = (row, col, color, grid, visited = new Set()) => {
                const key = `${row},${col}`;
                if (row < 0 || row >= GRID_SIZE || col < 0 || col >= GRID_SIZE || 
                    visited.has(key) || !grid[row][col] || grid[row][col].color !== color) {
                    return [];
                }

                visited.add(key);
                return [[row, col]].concat(
                    ...[[0, 1], [1, 0], [0, -1], [-1, 0]].map(([dr, dc]) =>
                        findConnected(row + dr, col + dc, color, grid, visited)
                    )
                );
            };

            return (
                <div className="bg-white p-8 rounded-xl shadow-2xl">
                    <h1 className="text-3xl font-bold text-center mb-6">BubbleBreaker</h1>
                    <div className="flex justify-between mb-4">
                        <div>Score: {score}</div>
                        <div>Highscore: {highScore}</div>
                    </div>
                    <div className="grid grid-cols-8 gap-2 mb-4" style={{width: '400px'}}>
                        {grid.map((row, r) => row.map((bubble, c) => (
                            <button
                                key={bubble?.id || `${r}-${c}`}
                                className={`bubble w-10 h-10 rounded-full ${bubble?.color || 'bg-gray-200'}`}
                                onClick={() => bubble && handleBubbleClick(r, c)}
                                disabled={!bubble}
                            />
                        )))}
                    </div>
                    <button 
                        onClick={initializeGrid}
                        className="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600"
                    >
                        Nieuw Spel
                    </button>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<BubbleBreaker />);
    </script>
</body>
</html>
